<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <TargetFramework>net6.0-android</TargetFramework>
        
        <SupportedOSPlatformVersion>21</SupportedOSPlatformVersion>
        <TargetFrameworkVersion>v12.0</TargetFrameworkVersion>
        <AndroidClassParser>class-parse</AndroidClassParser>
        <AndroidCodegenTarget>XAJavaInterop1</AndroidCodegenTarget>
        <DebugType>pdbonly</DebugType>
        <DefineConstants>TRACE</DefineConstants>

        <IsBindingProject>true</IsBindingProject>
        <DebugSymbols>true</DebugSymbols>
        <ErrorReport>prompt</ErrorReport>
        <WarningLevel>4</WarningLevel>
        <PackOnBuild>true</PackOnBuild>
        <OutputType>Library</OutputType>

        <!-- warning CS0618: 'IntentService' is obsolete: 'This class is obsoleted in this android platform' -->
        <!-- warning CS0618: 'IDfuSettingsConstants' is obsolete: 'This class is obsoleted in this android platform' -->
        <NoWarn>CS0618</NoWarn>

        <LaerdalPackageName>Laerdal.Dfu.Bindings.Android</LaerdalPackageName>
        <LaerdalPackageTags>Ble;Tools;Xamarin;Dfu;Bluetooth;Nordic;Semiconductor</LaerdalPackageTags>
        <LaerdalPackageCopyright>Fran√ßois Raminosona, Laerdal Medical</LaerdalPackageCopyright>
        <LaerdalPackageDescription>Xamarin wrapper around Nordic.Dfu for Android.</LaerdalPackageDescription>
        <LaerdalRepositoryUrl>https://github.com/Laerdal/Laerdal.Dfu.Bindings.Android</LaerdalRepositoryUrl>
    </PropertyGroup>

    <PropertyGroup>
        <RootNamespace>$(LaerdalPackageName)</RootNamespace>

        <PackageId>$(LaerdalPackageName)</PackageId>
        <PackageTags>$(LaerdalPackageTags)</PackageTags>
        <PackageDescription>$(LaerdalPackageDescription)</PackageDescription>
        <PackageProjectUrl>$(LaerdalRepositoryUrl)</PackageProjectUrl>
        <PackageVersion>0.0.1</PackageVersion>
        <PackageOutputPath Condition="'$(PackageOutputPath)' == ''">$([System.IO.Path]::Combine($(MSBuildThisFileDirectory), `../Output/`))</PackageOutputPath>
        <PackageIconPath>$([System.IO.Path]::Combine($(MSBuildProjectDirectory), `icon.png`))</PackageIconPath>
        <PackageLicencePath>$([System.IO.Path]::Combine($(MSBuildProjectDirectory), `../LICENSE`))</PackageLicencePath>
        <PackageReadMePath>$([System.IO.Path]::Combine($(MSBuildProjectDirectory), `../README.md`))</PackageReadMePath>
        <PackageIcon Condition="Exists('$(PackageIconPath)')">icon.png</PackageIcon>
        <PackageLicense Condition="Exists('$(PackageLicencePath)')">LICENSE</PackageLicense>
        <PackageReadmeFile Condition="Exists('$(PackageReadMePath)')">README.md</PackageReadmeFile>

        <GeneratePackageOnBuild>true</GeneratePackageOnBuild>
        <SymbolPackageFormat>snupkg</SymbolPackageFormat>
        <!-- sourcelink: Include PDB in the built .nupkg -->
        <AllowedOutputExtensionsInPackageBuildOutputFolder>$(AllowedOutputExtensionsInPackageBuildOutputFolder);.pdb</AllowedOutputExtensionsInPackageBuildOutputFolder>

        <AssemblyVersion>1.0.0.0</AssemblyVersion>
        <AssemblyName>$(LaerdalPackageName)</AssemblyName>

        <Title>$(LaerdalPackageName)</Title>
        <Summary>$(LaerdalPackageDescription)</Summary>
        <Description>$(LaerdalPackageDescription)</Description>
        <Authors>$(LaerdalPackageCopyright)</Authors>
        <Owners>$(LaerdalPackageCopyright)</Owners>
        <Copyright>$(LaerdalPackageCopyright)</Copyright>
        <RepositoryUrl>$(LaerdalRepositoryUrl)</RepositoryUrl>
        <PublishRepositoryUrl>true</PublishRepositoryUrl>
        <RepositoryType>git</RepositoryType>

        <IncludeSource>True</IncludeSource>
        <IncludeSymbols>True</IncludeSymbols>

        <!-- see : https://cezarypiatek.github.io/post/managing-output-in-sdk-projects/ -->
        <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
        <!-- sourcelink: Embed source files that are not tracked by the source control manager to the PDB -->
        <EmbedUntrackedSources>true</EmbedUntrackedSources>
        <!-- warning MSB9004: ManifestResourceWithNoCulture item type is deprecated. Emit EmbeddedResource items instead, with metadata WithCulture='false', Type='Resx', and optional LogicalName. -->
        <MSBuildWarningsAsMessages>$(MSBuildWarningsAsMessages);MSB9004</MSBuildWarningsAsMessages>
        <RestoreProjectStyle>PackageReference</RestoreProjectStyle>
        <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
    </PropertyGroup>
    
    <ItemGroup>
        <None Include="$(PackageIconPath)" Pack="true" PackagePath="\" Condition="Exists('$(PackageIconPath)')" />
        <None Include="$(PackageLicencePath)" Pack="true" PackagePath="\" Condition="Exists('$(PackageLicencePath)')" />
        <None Include="$(PackageReadMePath)" Pack="true" PackagePath="\" Condition="Exists('$(PackageReadMePath)')" />
    </ItemGroup>

    <!-- 
    <ItemGroup>
        <LibraryProjectZip Include="Jars\dfu.aar" />
        <ReferenceJar Include="Jars\gson.jar" />
    </ItemGroup> -->
    <ItemGroup>
      <AndroidLibrary Remove="Jars\gson.jar" />
      <EmbeddedReferenceJar Include="Jars\gson.jar" />
    </ItemGroup>
    <ItemGroup>
      <PackageReference Include="Xamarin.AndroidX.Core" Version="1.10.1.1" />
    </ItemGroup>
    <Target Name="_DownloadAndroidNativeFiles" BeforeTargets="BeforeCompile">
        <DownloadFile DestinationFileName="dfu.aar" DestinationFolder="Jars\" SourceUrl="https://repo1.maven.org/maven2/no/nordicsemi/android/dfu/2.3.0/dfu-2.3.0.aar" />
        <DownloadFile DestinationFileName="gson.jar" DestinationFolder="Jars\" SourceUrl="https://repo1.maven.org/maven2/com/google/code/gson/gson/2.10/gson-2.10.jar" />
    </Target>
</Project>